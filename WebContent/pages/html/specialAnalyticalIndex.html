
<!DOCTYPE html>
<html>

<head>
<meta charset="UTF-8">
<title></title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<!--设置视口的宽度(值为设备的理想宽度)，页面初始缩放值<理想宽度/可见宽度>-->
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" />
<link rel="stylesheet" href="css/layui.css">
<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="css/addStyle.css">
<link rel="stylesheet" href="css/modules/layer/default/layer.css">
<link rel="stylesheet" href="css/modules/laydate/default/laydate.css">
<link rel="stylesheet" href="font-size/iconfont.css">
<script src="js/pgis/c97a8f021352462ca167fcad3820df3c.js"></script>
<style>
.scroll-1 {
	width: 100%;
	height: 100%;
	overflow: auto;
}

.scroll-1::-webkit-scrollbar {
	width: 10px;
	height: 10px;
}

.scroll-1::-webkit-scrollbar-track {
	background: #ddd;
	box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.4);
	border-radius: 100px;
}

.scroll-1::-webkit-scrollbar-thumb {
	background: #666;
	border-radius: 100px;
	min-height: 28px;
}

.scroll-1::-webkit-scrollbar-thumb:hover {
	background: #555;
}
</style>
</head>

<body class="bgBackColor">

	<div class="scroll-1">

		<div class="layui-row">

			<div class="layui-col-md12 rightConSpace">

				<div class="titleRightCon">

					<span class="leftTextWhite">专题分析</span>

					<!-- <span class="rightTextGreen"><a href="specialAnalyticalCon.html"><i class="icon iconfont icon-mulu1"></i>&nbsp;专题概况</a></span> -->

				</div>

				<div class="layui-row marginTop20">
					<div class="layui-col-md12">
						<table class="leftRuleBtn">

							<tr>
								<td valign="top">

									<div>
										<span class="textWhite leftTextName">类别选择：</span>
										<div class="addDimension leftTextName"  style="width:200px;display: inline;padding:6px;" id="chooseType">
											<i class="icon iconfont">&#xe506;</i>&nbsp;&nbsp;&nbsp;选择类别(必选项)
										</div>
										<div id="fzType" style="display: inline;"></div>
										<input type="hidden" id="fzTypeInfo1" value="" />
										<input type="hidden" id="fzTypeInfo2" value="" />
										<input type="hidden" id="fzTypeInfo3" value="" />
										<input type="hidden" id="fzTypeInfo4" value="" />
									</div>
								</td>
							</tr>
							<tr>
								<td valign="top">
									<div>
										<span class="textWhite leftTextName">派出所选择：</span>
										<div class="addDimension leftTextName"  style="width:200px;display: inline;padding:6px;" id="choosePcs">
											<i class="icon iconfont">&#xe506;</i>&nbsp;&nbsp;&nbsp;选择派出所(可选项)
										</div>
										<div id="fzPcs" style="display: inline;"></div>
									</div>
								</td>
							</tr>
							<tr>
								<td valign="top">
									<div style="display: inline;">
										<div class="textWhite leftTextName" style="display: inline;">时间选择：</div>
										<input type="text" name="time" id="test6"
											style="width: 200px;display: inline;" value="" class="layui-input "
											placeholder="选择时间" />
									</div>
									<button class="layui-btn layui-btn-sm" style="display: inline;margin-left:10px;" onclick="searchInfo()">开始分析
									</button>
								</td>
							</tr>
						</table>
					</div>
				</div>

				<div class="layui-row layui-col-space10 tableConTwo"
					style="height: 600px; margin: 0;">

					<div class="layui-col-md9">
						<div id="longquanMap"
							style="width: 100%; height: 600px; margin-top: -5px; margin-left: -5px;background-color: white"></div>
					</div>

					<div class="layui-col-md3"
						style="height: 600px; overflow-x: hidden">

						<div class="scroll-1">

							<table class="rightRuleBtn">

								<tbody>
									<tr>
										<td>
											<div class="textWhite">专题概况</div>
											<span class="textColor" id="text1">选择类型、时间后，按发生的案件类型、案件数量降序显示最多3条
											</span>
										</td>
									</tr>
									<tr>
										<td>
											<div class="textWhite">高危辖区</div><span class="textColor" id="text2">选择类型、时间后，按接警派出所名称、案件数量降序显示最多3条
												</span>
										</td>
									</tr>
									<tr>
										<td>
											<div class="textWhite">高危地段</div> <span class="textColor">双龙路</span>
										</td>
									</tr>
									<tr>
										<td>
											<div class="textWhite">高危时段</div> <span class="textColor"
											id="gwsd"></span>
										</td>
									</tr>
									<tr>
										<td>
											<div class="textWhite">高危人群</div> <span class="textColor">河南籍<a
												href="">详情>></a></span>
										</td>
									</tr>
									<tr>
										<td>
											<div class="textWhite">关键字钻取</div>
											<div id="wordcloud"
												style="width: 100%; height: 200px; border1: 1px solid #d2d2d2;"></div>
										</td>
									</tr>
								</tbody>

							</table>

						</div>

					</div>

				</div>

			</div>

		</div>

	</div>
	<script src="layui.js"></script>
	<script src="js/echarts.js"></script>
	<!--<script type="text/javascript" src="js/longquanMap.json"></script>-->
	<script src="js/echarts-wordcloud.js"></script>
	<script src="lay/modules/tree.js"></script>
	<script src="lay/modules/laydate.js"></script>
	<script src="js/jquery-3.1.1.js"></script>
	<script src="lay/modules/layer.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<!-- 最新的echarts核心 JavaScript 文件 -->
	<script src="lay/modules/code.js"></script>
	<script src="lay/modules/carousel.js"></script>
	<script src="lay/modules/element.js"></script>
	<script src="lay/modules/jquery.js"></script>
	<script src="lay/modules/form.js"></script>
	<script src="lay/modules/layedit.js"></script>
	<script src="lay/modules/laypage.js"></script>
	<script src="lay/modules/laytpl.js"></script>
	<script src="lay/modules/mobile.js"></script>
	<script src="lay/modules/rate.js"></script>
	<script src="lay/modules/table.js"></script>
	<script src="lay/modules/util.js"></script>
	<script src="lay/modules/upload.js"></script>
	<script src="lay/modules/scrollbar.min.js"></script>
	<script src="../style/js/jqfx/ztyp/ztyp.js"></script>
	<script type="text/javascript" src='js/pgis/ztyp/ztypmap.js'></script>
	<script type="text/javascript">

	$('#choosePcs').on("click", function(){
		$('#fzTypeInfo4').val('');
		layer.open({
			id:1,
			icon: 1,       
		    type: 2,
	        title:'选择派出所',
	        skin: 'layer-ext-moon',
	        area:['360px', '460px'],
		    shade: 0.6,
			content: 'choosePcs.html',
	        btn:['确定','取消'],
	        btn1: function (index,layero) {
	        	var data = $(layero).find("iframe")[0].contentWindow.getTarget();
	        	var html = '';
	        	var text = '';
	        	for(var i=0;i<data.length;i++){
	        		html +="<div class='chooseData1' style='display:inline;padding:6px;'>"+data[i].innerHTML+"</div>"
	        		if(i != data.length-1){
	        			text += data[i].innerHTML+',';
	        		}else{
	        			text += data[i].innerHTML;
	        		}
	        	}
	        	$('#fzTypeInfo4').val(text);
	        	$("#fzPcs").html(html);
	        	layer.close(index);
	        },
	        btn2:function (index,layero) {
	        	 layer.close(index);
	        }
		});    
	});
	<!--弹出窗口-选择类别 start -->	
	$('#chooseType').on("click", function(){
		
	  //点击选择类型时，清空＜div　id=fzType＞中的内容
	  document.getElementById('fzType').innerHTML = "";
	  $('#fzTypeInfo1').val('');	  
	  $('#fzTypeInfo2').val('');	  
	  $('#fzTypeInfo3').val('');	  
	  layer.open({
			id:1,
			icon: 1,       
		    type: 2,
	        title:'选择类别',
	        skin: 'layer-ext-moon',
	        area:['360px', '460px'],
		    shade: 0.6,
			content: 'chooseType.html',
	        btn:['确定','取消'],
	        btn1: function (index,layero) {
	        	
	        	//获取到选复选框选中的节点
	        	var chooseTypeData = $(layero).find("iframe")[0].contentWindow.getNodes();
	        	var html="";
	        	var strArr = '';
	        	var nameArr = '';
	        	var parentArr = '';
	        	if(chooseTypeData.length < 6){
	        		for(var i=0;i<chooseTypeData.length;i++){
	     				if(i != chooseTypeData.length-1){
	     					strArr += chooseTypeData[i].id+',';
	     					nameArr += chooseTypeData[i].name+',';
	     					parentArr += chooseTypeData[i].isParent+',';
	     				}else{
	     					strArr += chooseTypeData[i].id;
	     					nameArr += chooseTypeData[i].name;
	     					parentArr += chooseTypeData[i].isParent;
	     				}
		        		html +="<div class='chooseData1' style='display:inline;padding:6px;'>"+chooseTypeData[i].name+"</div>"
		        	}
	        	}else{
	        		alert('请选择不超过5条的数据');
	        		layer.close(index);
	        	}
	        	$('#fzTypeInfo1').val(strArr);	  
	        	$('#fzTypeInfo2').val(nameArr);	 
	        	$('#fzTypeInfo3').val(parentArr);	 
	        	$("#fzType").html(html);
	        	layer.close(index);
	    	},
	        btn2:function (index,layero) {
	        	
	        	 layer.close(index);
	        }

	   });
	});
	<!--弹出窗口-选择类别 end -->

	layui.use('laydate', function(){
		  var laydate = layui.laydate;
		  
		   //日期范围
		  laydate.render({
		    elem: '#test6'
			,theme: 'grid'
		    ,range: true,
		    done: function(value){//控件选择完毕后的回调---点击日期、清空、现在、确定均会触发。
		   	 
				if(value!=""){
					var str = value.split("-");
					var startDate = str[0]+"-"+str[1]+"-"+str[2]+"00:00:00";
					var endDate = str[3]+"-"+str[4]+"-"+str[5]+" 23:59:59";
					
					//高危区域
					//getGwqy(startDate,endDate);
					//高危时段
					//getGwsd(startDate,endDate);
					
				}
			}
		  });
		  
		});
			
	function forMap(startDate,endDate,strArr,nameArr,parentArr,pcsArr){
		$.ajax({
			url:'../jqfx/selectType/forMap',
			type:'get',
			dataType:'json',
			data:{
				startTime:startDate,
				endTime:endDate,
				strArr:strArr,
				nameArr:encodeURI(nameArr),
				parentArr:parentArr,
				pcsArr:encodeURI(pcsArr)
			},
			success:function(msg){
				//获取返回的经纬度数据
				var data = msg.list;
				showHeatMark(data);
			}
		});
	}
	
		function showGwxq(startDate,endDate,strArr,nameArr,parentArr,pcsArr){
			$.ajax({
				url:'../jqfx/selectType/gwxq',
				type:'get',
				dataType:'json',
				data:{
					startTime:startDate,
					endTime:endDate,
					strArr:strArr,
					parentArr:parentArr,
					pcsArr:encodeURI(pcsArr)
				},
				success:function(msg){
					var text = '';
					for(var i=0;i<msg.length;i++){
						text += msg[i].pcsname+msg[i].count+'件'
						if(i != msg.length-1){
							text += ', ';
						}
					}
					text += "<a onclick='showGwqy(\""+startDate+"\",\""+endDate+"\",\""+strArr+"\",\""+nameArr+"\",\""+parentArr+"\",\""+pcsArr+"\")'>详情>></a>"
					document .getElementById("text2").innerHTML = text;
				}
			});
		}
		function showZtgk(startDate,endDate,strArr,nameArr,parentArr,pcsArr){
			$.ajax({
				url:'../jqfx/selectType/ztgk',
				type:'get',
				dataType:'json',
				traditional:true,
				data:{
					startTime:startDate,
					endTime:endDate,
					strArr:strArr,
					parentArr:parentArr,
					nameArr:encodeURI(nameArr),
					pcsArr:encodeURI(pcsArr)
				},
				success:function(msg){
					var text = '';
					for(var i=0;i<msg.length;i++){
						text += msg[i].typeName+msg[i].count+'件'
						if(i != msg.length-1){
							text += ', ';
						}
					}
					text += "<a onclick='showEatch(\""+startDate+"\",\""+endDate+"\",\""+strArr+"\",\""+nameArr+"\",\""+parentArr+"\",\""+pcsArr+"\")'>详情>></a>"
					document .getElementById("text1").innerHTML = text;
				}
			});
		}	
			
		<!--关键字钻取 start -->

		    var myChart = echarts.init(document.getElementById('wordcloud'));
		 
		   
			
			var dataCloud = {
				"cloudData":
		        [
		            {name: "装修",value:2200},
					{name: "漏水",value:100},
					{name: "扰民",value:1450},
					{name: "广场",value:1850},
					{name: "煤气泄露",value:450},
					{name: "建筑工地",value:500},
					{name: "食品安全",value:1100},
					{name: "牛奶",value:850},
					{name: "赌博",value:350},
					{name: "倒塌",value:250},
					{name: "盗窃",value:1300},
					{name: "菜市场",value:1600},
					{name: "争吵",value:750},
					{name: "打架",value:200},
					{name: "聚集",value:2400},
					{name: "车",value:1250},
					{name: "停车场",value:2000},
					{name: "小区",value:3250},
					{name: "学校",value:2589}
		        ],
				"cloudDiv":"wordcloud"
		};

		var createRandomItemStyle1 = function (params) {　　　　//此方法与下方配置中的第一个textStle下的color等同
		    var colors = ['#7e9cd4', '#94b0e4', '#abc3f1', '#bbd0f8', '#cbdcfb', '#d7e5fe'];
		    return colors[parseInt(Math.random() * 6)];
		}

		function _setWordCloud (cloudData) {
		    var option = {
		        series: [
		            {
		                type: 'wordCloud',
		                shape: 'ellipse',
						//shape:'smooth',  //平滑
		                gridSize:2,
		                textStyle: {
		                    normal: {
		                        fontFamily: '微软雅黑',
		                        color: function () {
		                            var colors = ['#7e9cd4', '#94b0e4', '#abc3f1', '#bbd0f8', '#cbdcfb', '#d7e5fe'];
		                            return colors[parseInt(Math.random() * 6)];
		                        }
		                    }
		                },
		    
		                data: cloudData
		            }
		        ]
		    };
		    return option;
		};
		
 		//点击'开始分析'事件
	 	function searchInfo(){
 			var strArr = $('#fzTypeInfo1').val();
 			var nameArr = $('#fzTypeInfo2').val();
 			var parentArr = $('#fzTypeInfo3').val();
 			var pcsArr = $('#fzTypeInfo4').val();
 			//获取时间
	 		var startDate = "";
			var endDate = "";
			if($("#test6").val()!=""){
				var str = $("#test6").val().split("-");
				 startDate = str[0]+"-"+str[1]+"-"+str[2]+"00:00:00";
				 endDate = str[3]+"-"+str[4]+"-"+str[5]+" 23:59:59";
			}
			if(startDate == null || startDate == '' || nameArr == null || nameArr ==''){
				alert('请选择犯罪类型或时间段')
			}else{
				showZtgk(startDate,endDate,strArr,nameArr,parentArr,pcsArr);
				showGwxq(startDate,endDate,strArr,nameArr,parentArr,pcsArr);
				forMap(startDate,endDate,strArr,nameArr,parentArr,pcsArr);
			}
		}  
		//词云图初始化
		function initWordCloud(wordCloudData) {
		    var option = _setWordCloud(wordCloudData.cloudData);
		    var myChart = echarts.init(document.getElementById(wordCloudData.cloudDiv));
		    myChart.on('click', function (param) {

			    var index= layer.open({
					type : 2,
					title : '查看详情',
					maxmin : true,
					area:['1000px', '640px'],
					shadeClose : false, // 点击遮罩关闭层
					content : 'wordCloudView.html' // iframe的url
				})  
			
			});
			myChart.setOption(option);
		}

		initWordCloud(dataCloud);

		<!--关键字钻取 end -->

		 <!--龙泉驿地图 start -->
			var map = new BMap.Map("longquanMap");          // 创建地图实例  
			var point = new BMap.Point(104.274227,30.553425);  // 创建点坐标
			var opts = {type: BMAP_NAVIGATION_CONTROL_LARGE};
			map.centerAndZoom(point, 15);                 // 初始化地图，设置中心点坐标和地图级别  
			map.enableScrollWheelZoom(true);
			var local = new BMap.LocalSearch(map, {
				renderOptions:{map: map}
			});	
			//local.search("派出所");
			//热力图
			var points =[
		    {"lng":104.274227,"lat":30.553425,"count":15},
		    {"lng":104.274327,"lat":30.553425,"count":15},
		   /*  {"lng":104.298387,"lat":30.693327,"count":51},
		    {"lng":104.33647,"lat":30.648352,"count":115},
		    {"lng":104.273918,"lat":30.575948,"count":40},
		    {"lng":104.405944,"lat":30.613609,"count":0},
		    {"lng":104.2552,"lat":30.599393,"count":166},
			{"lng":104.160201,"lat":30.614568,"count":50},
		    {"lng":104.358853,"lat":30.510944,"count":351},
		    {"lng":104.323937,"lat":30.545266,"count":15},
		    {"lng":104.278564,"lat":30.581971,"count":140},
		    {"lng":104.278727,"lat":30.581712,"count":0},
		    {"lng":104.321197,"lat":30.540796,"count":168},
			{"lng":104.441436,"lat":30.637232,"count":66},
			{"lng":104.3831,"lat":30.680167,"count":150},
		    {"lng":104.384062,"lat":30.679757,"count":51},
		    {"lng":104.35492,"lat":30.695406,"count":185},
		    {"lng":104.394536,"lat":30.654387,"count":240},
		    {"lng":104.332923,"lat":30.641782,"count":0},
		    {"lng":104.319284,"lat":30.648442,"count":258},
			{"lng":104.194691,"lat":30.665779,"count":140},
		    {"lng":104.183874,"lat":30.669584,"count":0},
		    {"lng":104.198146,"lat":30.594158,"count":168},
			{"lng":104.257061,"lat":30.577969,"count":166},
			{"lng":104.267035,"lat":30.58076,"count":150},
		    {"lng":104.267179,"lat":30.578138,"count":151},
		    {"lng":104.193852,"lat":30.552691,"count":185},
		    {"lng":104.354929,"lat":30.695268,"count":240},
		    {"lng":104.33349,"lat":30.642138,"count":0},
		    {"lng":104.31748,"lat":30.615828,"count":258},
			{"lng":104.235311,"lat":30.661361,"count":140},
		    {"lng":104.177676,"lat":30.641149,"count":0},
		    {"lng":104.174486,"lat":30.625981,"count":68},
			{"lng":104.274518,"lat":30.562852,"count":66},
			{"lng":104.266031,"lat":30.570695,"count":150},
		    {"lng":104.229162,"lat":30.523758,"count":151},
		    {"lng":104.298509,"lat":30.693185,"count":85},
		    {"lng":104.336411,"lat":30.648475,"count":24},
		    {"lng":104.331656,"lat":30.648017,"count":0},
		    {"lng":104.194722,"lat":30.665964,"count":258},
			{"lng":104.167797,"lat":30.669241,"count":0} */
			];

			
			//标注点及标签
			function addMarker(point){
				var marker = new BMap.Marker(point);
				map.addOverlay(marker);
				marker.addEventListener("click",attribute);
			}
			//map.setViewport(pointArray);
			for (var i = 0; i < points.length; i ++) {
				var point = new BMap.Point(points[i].lng , points[i].lat );
				
				addMarker(point);
				
				//addMarker(point);
			}
			 
			//单击触发事件
			function attribute(e){
				var p = e.target;
				var index= layer.open({
					type : 2,
					title : '查看详情',
					maxmin : true,
					area:['1000px', '640px'],
					shadeClose : false, // 点击遮罩关闭层
					content : 'policeView.html' // iframe的url
				})
				//layer.full(index);
			}	


			//单击触发事件 专题概况
			function showEatch(startTime,endTime,strArr,nameArr,parentArr,pcsArr){
				var index= layer.open({
					type : 2,
					title : '专题概况',
					maxmin : true,
					area:['1200px', '640px'],
					shadeClose : false, // 点击遮罩关闭层
					content : 'policeViewTjt.html?startTime='+startTime+'&endTime='+endTime+'&nameArr='+nameArr+'&strArr='+strArr+'&parentArr='+parentArr+'&pcsArr='+pcsArr // iframe的url
				})
			}	
			
			//单击触发事件  高危区域
			 function showGwqy(startTime,endTime,strArr,nameArr,parentArr,pcsArr){
				
				var index= layer.open({
					type : 2,
					title : '高危区域',
					maxmin : true,
					area:['1200px', '640px'],
					shadeClose : false, // 点击遮罩关闭层
					content : 'gwqyList.html?startTime='+startTime+'&endTime='+endTime+'&nameArr='+nameArr+'&strArr='+strArr+'&parentArr='+parentArr+'&pcsArr='+pcsArr // iframe的url
				});
			}	 
			
			//单击触发事件  高危区域
			/* function showGwsd(e){
			
				var startDate = "";
				var endDate = ""
				var time = $("#test6").val();
				if(time!=""||time==null){
					var str = time.split("-");
					var startDate = str[0]+"-"+str[1]+"-"+str[2]+"00:00:00";
					var endDate = str[3]+"-"+str[4]+"-"+str[5]+" 23:59:59";
				}
				var index= layer.open({
					type : 2,
					title : '查看详情',
					maxmin : true,
					area:['1200px', '640px'],
					shadeClose : false, // 点击遮罩关闭层
					content : 'gwsdList.html?startTime='+startDate+'&endTime='+endDate+"?fztype="+$("#fzTypeInfo").val() // iframe的url
				})
				//layer.full(index);
			} */	 
	<!--龙泉驿地图 end -->
</script>

</body>

</html>